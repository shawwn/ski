<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#2052BB">
<meta name="author" content="Bartosz Ciechanowski">
<meta name="format-detection" content="telephone=no">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-25335284-3"></script>


<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-25335284-3');
</script>
  <meta property="og:title" content="GPS – Bartosz Ciechanowski" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ciechanow.ski/gps/" />
<meta property="og:description" content="Interactive article explaining how GPS works." />
<meta property="og:image" content="https://ciechanow.ski/images/og/gps.png" />
<meta name="twitter:title" content="GPS – Bartosz Ciechanowski" />
<meta name="twitter:site" content="@BCiechanowski" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://ciechanow.ski/images/og/gps.png" />
<meta property="og:locale" content="en_US">
    <meta name="keywords" content="satellite,positioning,trilateration,pseudorange,orbit,ellipse,PRN,ephemeris">
  <link href="../css/base.css?2fdf9770" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Lato:700&display=swap" rel="stylesheet" type="text/css" async>
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,400i,500&display=swap" rel="stylesheet" async>
  <title>GPS – Bartosz Ciechanowski</title>
  <link rel="icon" href="../favicon.ico">
  <link href="../css/gps.css" rel="stylesheet" type="text/css" />
  <script defer src="../js/base.js?ec479c57"></script>
  <script defer src="../js/gps.js"></script>
</head>

<body>
  <div id="main_container">
    <div id="body">
      <div id="banner">
    <div id="banner_wrapper">
        <div id="banner_content">
            <div id="site_title">
                <a href="../index.html">Bartosz Ciechanowski</a>
            </div>
            <div id="navigation">
                <a href="../index.html">Blog</a>
                <a href="../archives.html">Archives</a>
            </div>
            <div id="social">
                <a class="patreon" href="https://www.patreon.com/ciechanowski" title="Patreon"><div class="patreonLogo">Patreon</div></a>
                <a class="twitter" href="https://twitter.com/bciechanowski" title="X / Twitter"><div class="twitterLogo">X / Twitter</div></a>
                <a class="instagram" href="https://www.instagram.com/bartoszciechanowski/" title="Instagram"><div class="igLogo">Instagram</div></a>
                <a class="email" href="mailto:bartosz@ciechanow.ski" title="e-mail"><div class="emailLogo">e-mail</div></a>
                <a class="rss" href="../atom.xml" title="RSS"><div class="rssLogo">RSS</div></a>
            </div>
        </div>
    </div>
</div>

      <div id="content">
        
<div class="article">
    <div class="post_date">January 18, 2022</div>
    <h1 class="post_title"><a href="index.html">GPS</a></h1><p>Global Positioning System is, without a doubt, one of the most useful inventions of the late 20<sup>th</sup> century. It made it significantly easier for ships, airplanes, cars, and hikers to figure out where they are with high degree of accuracy.</p>
<p>One of the most exciting aspects of this system are the satellites surrounding Earth. Here&rsquo;s a current constellation of active satellites, you can drag the view around to see it from different angles:</p>
<div class="dark_light_bg_grad_top"></div>
<div class="dark_light_bg"  id="gps_hero_background" >
    <div class="bg_content">
        
<div class="drawer_container ratio_100" id="gps_orbits_hero"></div>

    </div>
</div>
<div class="dark_light_bg_grad_bottom"></div>
<p>However, the satellites are just a part of what makes GPS possible. While I&rsquo;ll discuss their motion in depth, over the course of this blog post I&rsquo;ll also explain <em>how</em> the satellites help a GPS receiver determine where it is, and I&rsquo;ll dive into the clever methods the system uses to make sure the signals sent all the way from space are reliably decoded on Earth.</p>
<p>We&rsquo;ll start by creating a positioning system that can tell us where we are. Our initial approach will be quite simple, but we&rsquo;ll step-by-step improve upon it to build an understanding of the positioning method used by GPS.</p>
<h1 id="simple-positioning">Simple Positioning<a href="index.html#simple-positioning" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>Here&rsquo;s a small chunk of a world we&rsquo;ll be playing with. The little <span class="figurine"><strong>yellow figurine</strong></span> represents our position in that world – you can grab and move it around. You can also drag the landscape itself to change the viewing angle. The view on the right represents a map of that landscape – we&rsquo;ll try to evaluate where <em>exactly</em> the <span class="figurine"><strong>figurine</strong></span> is on this map:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map0"></div>
</div>
<p>This situation may seem a bit daunting, but notice that the landscape we&rsquo;re in has <span style="color:#3FBF15"><strong>three</strong></span> <span style="color:#4CA3E3"><strong>little</strong></span> <span style="color:#CD5353"><strong>landmarks</strong></span> on the ground that are easy to reference on the map. Just by using these three reference points we can attempt to relate the <span class="figurine"><strong>figurine&rsquo;s</strong></span> position in the environment to an approximate placement on the map.</p>
<p>Intuitively, if we&rsquo;re standing right on top of one of the colored landmarks, then we can tell <em>exactly</em> where we are on the map. If we take a single step away from a landmark, then our accuracy will degrade a little, but we&rsquo;re still reasonably sure of our position. However, as we keep going further away the uncertainty in our estimate increases.</p>
<p>We can draw that estimation of our position on the map using a <span class="figurine"><strong>yellow area</strong></span>. Its size symbolizes uncertainty – the more of a guesswork we&rsquo;re doing the bigger the circle. We also know where, more or less, to place that <span class="figurine"><strong>yellow area</strong></span> based on our position relative to the landmarks. For instance, if we&rsquo;re between the <span style="color:#3FBF15"><strong>green landmark</strong></span> and the <span style="color:#4CA3E3"><strong>blue landmark</strong></span> then we&rsquo;ll be somewhere between those two dots on the map as well:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map1"></div>
</div>
<p>The further away from a landmark we are, the larger the uncertainty, but the <em>distance</em> to a landmark itself also carries some information. If we attach a <span style="color:#7B6345"><strong>rope</strong></span> to a <span class="landmark_blue"><strong>landmark</strong></span> and walk away holding the other end, it will at some point prevent us from going further. Moreover, if we keep the <span style="color:#7B6345"><strong>rope</strong></span> taut it will limit our motion to a circular path around that <span class="landmark_blue"><strong>landmark</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container ratio_100" id="string"></div>
</div>
<p>Since the <span style="color:#7B6345"><strong>rope</strong></span> has a fixed length, every point on that circle is at the same distance to the <span class="landmark_blue"><strong>landmark</strong></span>. Instead of using a <span style="color:#7B6345"><strong>rope</strong></span> we can attach a measuring tape to a landmark and track the measured distance as we roam around. A measured distance lets us draw an appropriately sized circle on the map, based on the map&rsquo;s scale. We know that we have to be somewhere on that circle, because all the points on that circle are equally distant to the <span class="landmark_green"><strong>landmark</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map2"></div>
</div>
<p>If we also keep track of the distance to the <span class="landmark_blue"><strong>second landmark</strong></span> we know that our position is somewhere on the intersection of those two circles because the intersections are the only places that have the expected distances to <em>both</em> locations:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map3"></div>
</div>
<p>With two distance measurements there are only two possible positions on the map where we could be located. Measuring distance to the <span class="landmark_red"><strong>third landmark</strong></span> narrows down that location to just a single choice:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map4"></div>
</div>
<p>Notice that this third measurement is often redundant. We usually just &ldquo;know&rdquo; which of the two positions on the map makes sense given our position on the ground relative to the landmarks we see. In the demonstration below we&rsquo;re measuring distances to just two landmarks, unless we&rsquo;re almost inline with them, it&rsquo;s usually fairly clear which answer is the right one:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map5"></div>
</div>
<p>The process of calculating a location of a point using measurement of distances is called <em>trilateration</em> – that procedure lies at the heart of a GPS receiver. However, being tied to two or three measuring tapes is certainly <em>not</em> how any GPS device functions, so let&rsquo;s keep on making our primitive positioning system better.</p>
<h1 id="time-of-flight">Time of Flight<a href="index.html#time-of-flight" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>The only purpose of the measuring tapes was to measure distances, but there are other ways to figure out how far away something is. For example, when we drive a car at a more or less <em>constant</em> speed of <span class="imperial_word">60 mph</span><span class="metric_word">60 km/h</span> we can easily calculate that after 15 minutes we&rsquo;ve traveled a distance of around <span class="imperial_word">15 mi</span><span class="metric_word">15 km</span>. As a side note, I&rsquo;m using <span class="imperial_word">imperial</span><span class="metric_word">metric</span> units here, but you can <a href="index.html#" class="link_button" onclick="switch_units();return false;">switch</a> to <span class="imperial_word">the metric</span><span class="metric_word">the imperial</span> system if you prefer.</p>
<p>Instead of driving from point to point we can fly a little drone around. In the simulation below you can control the progress of <span class="user_clock"><strong>time</strong></span> with the slider. The clock marks the time between the drone starting and ending its journey with a <span style="color:#85ADCD"><strong>blue arc</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_drone0"></div>
</div>
<div class="slider_time" id="map_drone0_sl0"></div>
<p>In the bottom part of the demonstration I put a timeline that also tracks the duration of flight using a bit more compact representation – you can think of it as a clock unwrapped from an arc shape to a straight line. Notice that the length of the blue bar is directly tied to the duration of the flight, which in turn is directly tied to the traveled distance. When you  <a href="index.html#" class="link_button" onclick="map_drone0_f0();return false;">change position</a>, the duration of flight needed to reach the goal changes as well.</p>
<p>The constant velocity of a drone allows us to use <em>time</em> as a measure of distance, because that distance <span style="color:#000"><strong>s</strong></span> is proportional to the <em>time of flight</em> <span style="color:#000"><strong>t</strong></span> with drone&rsquo;s velocity <span style="color:#000"><strong>v</strong></span> acting as a scaling factor:</p>
<div class="equation">
s = v &times; t
</div>
<p>Let&rsquo;s see how we can employ two drones to replicate the measurements we did with two tapes. In the demonstration below we&rsquo;re sending two drones at the same time, the slider once again controls the <span class="user_clock"><strong>time</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_drone1"></div>
</div>
<div class="slider_time" id="map_drone1_sl0"></div>
<p>As the drones arrive to their destinations we get the direct measure of distance to each landmark as shown by the length of their bars on the timeline. This allows us to draw the circles of range on the map which in turn pinpoints our position.</p>
<p>This method is less restrictive than the measuring tapes we&rsquo;ve used, but having to fly drones to the landmarks to measure distances is still a bit ridiculous. However, the idea of using time of flight is very promising, we just need to come up with a faster and more convenient messenger.</p>
<p>Thankfully, we don&rsquo;t have to look too far. We can use the very same substance that allows drones to fly – the <em>air</em> itself. Instead of rapidly moving it around to generate lift for the little machines, we&rsquo;ll just make noises and let the air propagate <em>sounds</em> through itself.</p>
<h1 id="do-you-hear-me">Do you hear me?<a href="index.html#do-you-hear-me" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>While at close ranges the sound seems to propagate almost instantaneously, at longer distances we can certainly witness the limits of the speed of sound – you&rsquo;ve probably experienced the delay between <em>seeing</em> a lightning bolt and <em>hearing</em> its thunder. There is even a convenient rule of thumb that states that the strike was another <span class="imperial_word">1 mile</span><span class="metric_word">1 kilometer</span> away for every <span class="imperial_word">5</span><span class="metric_word">3</span> seconds of delay.</p>
<p>We can use sound to measure distances with a very simple setup. We&rsquo;ll put a microphone and a light bulb at each landmark – when a microphone detects a loud sound the light bulb will turn on. To measure the distance to a landmark we&rsquo;ll make a noise – I&rsquo;m visualizing the propagation of that noise with a <span style="color:#444"><strong>dark ring</strong></span>. As <span class="user_clock"><strong>time</strong></span> passes the <span style="color:#444"><strong>sound wave</strong></span> travels further and we can mark how long it took for the lightbulb to turn on:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_sound0"></div>
</div>
<div class="slider_time" id="map_sound0_sl0"></div>
<p>For now we can safely ignore the delay caused by the speed of light – at our limited scale it won&rsquo;t affect the measurement too much. If we mount microphones and lightbulbs at the other landmarks we can get a reliable system to measure distances, which lets us draw the circles on the map and mark our location:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_sound1"></div>
</div>
<div class="slider_time" id="map_sound1_sl0"></div>
<p>This solution actually works well, but it has a fatal flaw. As soon as someone else tries to estimate their position we may have a hard time recognizing if the flash happened because of our or <em>someone else&rsquo;s</em> sound. Let&rsquo;s see what happens when a <span style="color:#EC5B5B"><strong>red figurine</strong></span> also tries to estimate its position:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_sound2"></div>
</div>
<div class="slider_time" id="map_sound2_sl0"></div>
<p>Notice that we have no idea if we should stop the clock on the first or the second flash of a landmark, but regardless of the approach our measurements may be completely wrong. Even when we use the robust method of intersecting three circles we very often fail to converge to a single location. The more users trying to estimate their positions the more error prone everyone&rsquo;s range estimation would be, especially since they all can start making their noises at different times.</p>
<p>The problem with this approach is that we&rsquo;ve created an <em>active</em> system in which the landmarks have to actively respond to users’ requests to provide the needed information. As the number of users increases, the complexity of the system grows significantly. Even if we came up with some clever way for the landmarks to distinguish the incoming signals and emit different responses, we&rsquo;re guaranteed to find some number of users that would overwhelm the infrastructure.</p>
<p>Fortunately, we can solve this problem by flipping it on its head. Instead of the users sending audio signals to the landmarks, we&rsquo;ll have the landmarks emit the sounds and have the users listen to those sounds.</p>
<h1 id="do-i-hear-you">Do I hear you?<a href="index.html#do-i-hear-you" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>Let&rsquo;s rejig the landmarks to have a speaker that will emit a sound at every minute <em>on the minute</em>, that is when the second hand on the clock shows 0 seconds. When we hear the signal we can then check our clock to see how much time has elapsed and thus measure the distance:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_sound3"></div>
</div>
<div class="slider_time" id="map_sound3_sl0"></div>
<p>It may seem that this solution works well, but it requires a bit more attention. Notice that we&rsquo;re actually dealing with <em>two</em> different clocks here, one in our hand, and another one, located in the landmark itself, that drives the sound emission. Those two clocks may not be perfectly synchronized with each other.</p>
<p>In the demonstration below you can see the current time as tracked by the landmark on the <span class="system_clock"><strong>system clock</strong></span>, and as tracked by us on <span class="user_clock"><strong>our clock</strong></span> which can be <em>biased</em> by some amount – it could be early or late. Thankfully, with two clocks side by side we can try to correct for that <span class="bias"><strong>bias</strong></span> using the second slider:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_80" id="clocks"></div>
</div>
<div class="slider_time" id="clocks_sl0"></div>
<div class="slider_bias" id="clocks_sl1"></div>
<p>Notice that the timeline at the bottom shows progress of both the <span class="system_clock"><strong>system clock</strong></span> and the <span class="user_clock"><strong>user clock</strong></span> – if the clocks are not synchronized they&rsquo;re not tracking the same time.</p>
<p>Unfortunately, when we&rsquo;re out in the open exploring the environment we don&rsquo;t necessarily have access to the <span class="system_clock"><strong>system clock</strong></span> so we don&rsquo;t know <em>how</em> to synchronize <span class="user_clock"><strong>our clock</strong></span> with the <span class="system_clock"><strong>system clock</strong></span>. Even if we initially synchronize our clocks, they may drift apart over time. Our measurement of absolute time may be biased relative to the &ldquo;true&rdquo; <span class="system_clock"><strong>system time</strong></span>.</p>
<p>This has dire consequences – a landmark always emits its signal on the minute on the <span class="system_clock"><strong>system clock</strong></span>, but we think the signal was emitted on the minute on <span class="user_clock"><strong>our clock</strong></span>. Our estimate of the actual start time may be incorrect. Depending on the <span class="bias"><strong>bias</strong></span> of <span class="user_clock"><strong>our clock</strong></span>, this can cause us to under or overestimate the time of flight:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_sound4"></div>
</div>
<div class="slider_time" id="map_sound4_sl0"></div>
<div class="slider_bias" id="map_sound4_sl1"></div>
<p>For the sake of clarity I&rsquo;m still drawing the <span class="system_clock"><strong>blue bar</strong></span> on the timeline, but remember that we actually don&rsquo;t know what the current <span class="system_clock"><strong>system time</strong></span> is. The system always emits the signal when the <span class="system_clock"><strong>blue bar</strong></span> is at 0 seconds, but <em>we</em> think that the system emitted its signal when the <span class="user_clock"><strong>red bar</strong></span> is at 0 seconds.</p>
<p>If we get lucky and <span class="user_clock"><strong>our clock</strong></span> <a href="index.html#" class="link_button" onclick="map_sound4_f0();return false;">is synchronized</a> with the <span class="system_clock"><strong>system</strong></span> then what we consider the sound emission time will match exactly the <em>actual</em> emission time. If our clock is <a href="index.html#" class="link_button" onclick="map_sound4_f1();return false;">running behind</a>, then when we think the signal has <a href="index.html#" class="link_button" onclick="map_sound4_f2();return false;">just been emitted</a> it has actually been flying through the air for a while. Conversely, if our clock is <a href="index.html#" class="link_button" onclick="map_sound4_f3();return false;">running ahead</a>, then when the signal is <a href="index.html#" class="link_button" onclick="map_sound4_f4();return false;">actually emitted</a> we erroneously assume it&rsquo;s already been in the air for a while.</p>
<p>Because of that unknown <span class="bias"><strong>time bias</strong></span> we&rsquo;re no longer calculating the <em>true</em> time of flight and therefore we&rsquo;re not measuring the <em>true</em> range. Instead, we calculate a so-called <em>pseudorange</em>. The length of a pseudorange depends on what we assume the bias to be. This distance uncertainty sounds like trouble, so let&rsquo;s see how the presence of <span class="bias"><strong>bias</strong></span>  affects our ability to draw circles on a map:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_sound5"></div>
</div>
<div class="slider_time" id="map_sound5_sl0"></div>
<div class="slider_bias" id="map_sound5_sl1"></div>
<p>Notice that the circles on the map now change their radius with our attempts to account for the unknown <span class="bias"><strong>bias</strong></span>. We can no longer rely on just two circles as their intersection points move around with different values of that unknown <span class="bias"><strong>bias</strong></span>.</p>
<p>We&rsquo;re seemingly in big trouble, but there is an additional assumption we can make – we can safely expect the clocks in the landmarks to be synchronized with each other. Their location is stationary which means they can use large and very precise clocks that are continuously monitored to ensure synchronization. Since all the clocks in the landmarks have the same <span class="system_clock"><strong>system time</strong></span>, this also means that the <span class="bias"><strong>bias</strong></span> of <span class="user_clock"><strong>our clock</strong></span> to each of the landmarks is <em>exactly</em> the same.</p>
<p>Because that <span class="bias"><strong>bias</strong></span> is the same, all three of the measured distances are either too short, or too long by <em>the same</em> amount, and that amount depends precisely on the <span class="bias"><strong>bias</strong></span> of <span class="user_clock"><strong>our clock</strong></span> relative to the <span class="system_clock"><strong>system clock</strong></span>. Here&rsquo;s where the third measurement becomes indispensable:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_sound6"></div>
</div>
<div class="slider_time" id="map_sound6_sl0"></div>
<div class="slider_bias" id="map_sound6_sl1"></div>
<p>After we get <a href="index.html#" class="link_button" onclick="map_sound6_f0();return false;">all three signals</a> and we try to guess what the actual value of <span class="bias"><strong>bias</strong></span> was, there is only <a href="index.html#" class="link_button" onclick="map_sound6_f1();return false;">one value</a> of <span class="bias"><strong>bias</strong></span> at which all three circles intersect in one place – that&rsquo;s where we are on the map.</p>
<p>This is a monumental achievement. We&rsquo;re not only calculating the correct position, but also the exact value of the <span class="bias"><strong>bias</strong></span> of <span class="user_clock"><strong>our clock</strong></span>, so this setup also allows us to synchronize <span class="user_clock"><strong>our clock</strong></span> with the <span class="system_clock"><strong>time of the positioning system</strong></span> – we get a reliable source of accurate time. The only additional cost we had to pay for all of this is the need for the third emitter at a known location.</p>
<p>Moreover, the infrastructure we&rsquo;ve built is completely agnostic to the number of users it services. The emitted sounds don&rsquo;t care how many receivers are listening, each one can perceive the sounds on their own without interfering with anyone else&rsquo;s measurements:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_70" id="map_sound7"></div>
</div>
<div class="slider_time" id="map_sound7_sl0"></div>
<div class="slider_bias" id="map_sound7_sl1"></div>
<h1 id="leveling-up">Leveling Up<a href="index.html#leveling-up" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>So far our movements were restricted to just a flat 2D plane, but interesting things happen when we allow the <span class="figurine"><strong>figurine</strong></span> to get above the ground level. In the demonstration below you can control the user&rsquo;s <span style="color:#777"><strong>vertical position</strong></span> with a slider. To make things simpler, let&rsquo;s go back to our original idea of using measuring tapes to evaluate the distances:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map_ladder0"></div>
</div>
<div id="map_ladder0_sl0"></div>
<p>Notice that as the figurine gets <a href="index.html#" class="link_button" onclick="map_ladder0_f0();return false;">above the ground level</a>, the distances to the landmarks increase. We can no longer use the method of circles on the map, as they don&rsquo;t even converge on the same location.</p>
<p>When we allow movement in three dimensions, our transformations of distances to plain circles are no longer valid. Instead, a fixed distance defines an entire <em>sphere</em> around the marked point. For easier visualization let&rsquo;s first just put all three markers floating freely in a 3D space. A known <span style="color:rgb(129, 201, 116)"><strong>distance</strong></span> to the first location puts us somewhere on the surface of that sphere:</p>
<div class="padding_wrapper">
<div class="drawer_container ratio_100" id="spheres0"></div>
</div>
<div class="slider_green" id="spheres0_sl0"></div>
<p>With a <span style="color:rgb(99, 126, 210)"><strong>second measurement</strong></span> we can narrow down the possible location to the circle created by an intersection of two spheres:</p>
<div class="padding_wrapper">
<div class="drawer_container ratio_100" id="spheres1"></div>
</div>
<div class="slider_green" id="spheres1_sl0"></div>
<div class="slider_blue" id="spheres1_sl1"></div>
<p>To account for the third measurement we need to add a <em>third</em> intersecting sphere – it lets us narrow down the position to <span style="color:#000"><strong>two possible points</strong></span> where three circles intersect:</p>
<div class="padding_wrapper">
<div class="drawer_container ratio_100" id="spheres2"></div>
</div>
<div class="slider_green" id="spheres2_sl0"></div>
<div class="slider_blue" id="spheres2_sl1"></div>
<div class="slider_red" id="spheres2_sl2"></div>
<p>While we technically need a fourth sphere to differentiate between those <span style="color:#000"><strong>two points</strong></span>, three ranges are usually enough to figure out the exact position – if the centers of the spheres are far enough apart, one of the two possible solutions would be underground or in space.</p>
<p>Let&rsquo;s see how those concepts fit onto our map. To visualize the spheres we can no longer keep its surface lying flat. To make things easier to reference, I made the map rotate in sync with the main view. Notice that the intersection point of the three spheres lets us pinpoint the position <em>and</em> altitude even as you drag the <span class="figurine"><strong>figurine</strong></span> around:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_50" id="map_ladder1"></div>
</div>
<div id="map_ladder1_sl0"></div>
<p>Throughout these examples we&rsquo;ve been using the simple system of measuring tapes, so let&rsquo;s try to go back to the solution that used sound waves and pseudoranges. Recall that it didn&rsquo;t require the user to have the clocks perfectly synchronized:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map_ladder2"></div>
</div>
<div class="slider_time" id="map_ladder2_sl1"></div>
<div class="slider_bias" id="map_ladder2_sl2"></div>
<div id="map_ladder2_sl0"></div>
<p>Notice that the new dimension added a new complication. While in a flat case we could have just look for a single value of <span class="bias"><strong>bias</strong></span> for which the three circles have intersected, there are a lot of <em>different</em> values of <span class="bias"><strong>bias</strong></span> for which the three <em>spheres</em> intersect and we&rsquo;re incapable of precisely determining both the position and the altitude at which we are.</p>
<p>By analogy to the flat case, we need to add a <em>fourth</em> landmark to resolve this problem. We can then look for the value of the unknown <span class="bias"><strong>bias</strong></span> that makes four spheres intersect at a single location:</p>
<div class="padding_wrapper">
<div class="drawer_container full_width ratio_60" id="map_ladder3"></div>
</div>
<div class="slider_time" id="map_ladder3_sl1"></div>
<div class="slider_bias" id="map_ladder3_sl2"></div>
<div id="map_ladder3_sl0"></div>
<p>This method of measuring pseudoranges to at least four emitters at known positions is <em>exactly</em> what GPS uses to calculate the receiver&rsquo;s position and the time bias of its clock.</p>
<p>Before we continue developing our simple system, it may be worth pausing for a second to show the math underpinning the hand-wavy sphere resizing we&rsquo;ve been doing so far. We&rsquo;re dealing with four distances to four emitters and we end up with four equations:</p>
<div class="padding_wrapper">
<div class="equation" id="nav_equations" style="color:#444">
<div>
<span class="sqrt_long">(<span class="rounded_bg solution">x</span> &minus; <span class="rounded_bg landmark_red">x<sub>1</sub></span>)<sup>2</sup> + (<span class="rounded_bg solution">y</span> &minus; <span class="rounded_bg landmark_red">y<sub>1</sub></span>)<sup>2</sup> + (<span class="rounded_bg solution">z</span> &minus; <span class="rounded_bg landmark_red">z<sub>1</sub></span>)<sup>2</sup></span> = v &times; (<span class="rounded_bg landmark_red">t<sub>1</sub></span> &minus; <span class="rounded_bg solution">b</span>)
</div>
<div>
<span class="sqrt_long">(<span class="rounded_bg solution">x</span> &minus; <span class="rounded_bg landmark_green">x<sub>2</sub></span>)<sup>2</sup> + (<span class="rounded_bg solution">y</span> &minus; <span class="rounded_bg landmark_green">y<sub>2</sub></span>)<sup>2</sup> + (<span class="rounded_bg solution">z</span> &minus; <span class="rounded_bg landmark_green">z<sub>2</sub></span>)<sup>2</sup></span> = v &times; (<span class="rounded_bg landmark_green">t<sub>2</sub></span> &minus; <span class="rounded_bg solution">b</span>)
</div>
<div>
<span class="sqrt_long">(<span class="rounded_bg solution">x</span> &minus; <span class="rounded_bg landmark_blue">x<sub>3</sub></span>)<sup>2</sup> + (<span class="rounded_bg solution">y</span> &minus; <span class="rounded_bg landmark_blue">y<sub>3</sub></span>)<sup>2</sup> + (<span class="rounded_bg solution">z</span> &minus; <span class="rounded_bg landmark_blue">z<sub>3</sub></span>)<sup>2</sup></span> = v &times; (<span class="rounded_bg landmark_blue">t<sub>3</sub></span> &minus; <span class="rounded_bg solution">b</span>)
</div>
<div>
<span class="sqrt_long">(<span class="rounded_bg solution">x</span> &minus; <span class="rounded_bg landmark_yellow">x<sub>4</sub></span>)<sup>2</sup> + (<span class="rounded_bg solution">y</span> &minus; <span class="rounded_bg landmark_yellow">y<sub>4</sub></span>)<sup>2</sup> + (<span class="rounded_bg solution">z</span> &minus; <span class="rounded_bg landmark_yellow">z<sub>4</sub></span>)<sup>2</sup></span> = v &times; (<span class="rounded_bg landmark_yellow">t<sub>4</sub></span> &minus; <span class="rounded_bg solution">b</span>)
</div>
</div>
</div>
<p>The left sides of the equations are just distances between the <span class="rounded_bg solution"><strong>unknown position</strong></span> of the receiver and each of the <span class="rounded_bg landmark_red"><strong>red</strong></span>, <span class="rounded_bg landmark_green"><strong>green</strong></span>, <span class="rounded_bg landmark_blue"><strong>blue</strong></span>, and <span class="rounded_bg landmark_yellow"><strong>yellow</strong></span> emitters, calculated with 3D Pythagorean theorem. On the right side we have the four times of flight <strong>t</strong> from the emitters to the receiver, the unknown receiver bias <span class="rounded_bg solution"><strong>b</strong></span>, and velocity of propagation <strong>v</strong> which so far has been the speed of sound.</p>
<p>We&rsquo;re ultimately trying to solve this system of equations to get the receiver&rsquo;s <span class="rounded_bg solution"><strong>x</strong></span><span class="rounded_bg solution"><strong>y</strong></span><span class="rounded_bg solution"><strong>z</strong></span> position and its bias <span class="rounded_bg solution"><strong>b</strong></span>, but for the rest of the article I&rsquo;ll keep using the more abstract description of the problem since the mathematical operations aren&rsquo;t critical for our understanding of GPS.</p>
<h1 id="higher-better-faster-stronger">Higher, Better, Faster, Stronger<a href="index.html#higher-better-faster-stronger" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>It seems that the infrastructure we&rsquo;ve built allows us to correctly calculate our position and clock correction when we&rsquo;re close enough to the landmarks. If we want to make our positioning system work on the entire planet like GPS does we still have a few problems to solve.</p>
<p>Firstly, sound waves aren&rsquo;t the best way to send the signals around. Periodic loud beeping would be annoying to everyone around, but, more importantly, sounds get dispersed in the air quite quickly – you can&rsquo;t easily hear things that make sounds tens of <span class="imperial_word">miles</span><span class="metric_word">kilometers</span> away.</p>
<p>A good candidate for a better carrier would be light. Similarly to sound, it also has a limited speed of propagation which we can use to measure the traveled distance. The speed of light in vacuum <span style="color:#000"><strong>c</strong></span> is absolutely enormous and it has the following exact value<span class="imperial_word"> that, per its definition, I&rsquo;m showing in metric units</span>:</p>
<div class="equation">
c = 299 792 458 m/s
</div>
<p>It only takes light one billionth of a second to travel the distance of around <span class="imperial_word">1 foot</span><span class="metric_word">30 cm</span>. Unfortunately, light gets easily obscured by some atmospheric effects like fog, dust, clouds, or smoke so instead of visible light we&rsquo;ll use another form of <a href="https://en.wikipedia.org/wiki/Electromagnetic_radiation">electromagnetic radiation</a> – a radio wave of a certain frequency.</p>
<p>The second problem preventing us from deploying this system globally is related to visibility of the signal emitters. So far we assumed that our local environment is perfectly flat, but when a radio wave encounters a hill it gets blocked, which you can experience in the following simulation. In many cases the receiver will never get the signal unless we put the emitter high enough using the second slider:</p>
<div class="padding_wrapper">
<div class="drawer_container ratio_80" id="hill"></div>
</div>
<div class="slider_time" id="hill_sl0"></div>
<div id="hill_sl1"></div>
<p>By putting the emitter <a href="index.html#" class="link_button" onclick="hill_f0();return false;">at an altitude</a> we can thankfully mitigate that problem on a local scale. Unfortunately, we&rsquo;ve also been ignoring another important obstacle – the curvature of the Earth itself. To see that curvature, however, we have to rise way above the ground and venture into the blackness of space.</p>
<div class="dark_light_bg_grad_top"></div>
<div class="dark_light_bg" >
    <div class="bg_content">
        
<p>In the demonstration below you can witness how the emitted waves are masked by the shape of the planet depending on the altitude of the <span style="color:rgb(255, 35, 21)"><strong>emitter</strong></span>:</p>
<div class="drawer_container ratio_60" id="visible_area"></div>
<div id="visible_area_sl0"></div>
<p>The Earth&rsquo;s curvature acts as a hill that obscures areas that lie beyond the horizon as seen by the <span style="color:rgb(255, 35, 21)"><strong>emitter</strong></span>. Thankfully, the higher we put the <span style="color:rgb(255, 35, 21)"><strong>emitter</strong></span>, the larger the area it sees. We can visualize that area in three dimensions using a cone:</p>
<div class="drawer_container ratio_110" id="visible_cone"></div>
<div id="visible_cone_sl0"></div>
<p>Naturally, we can&rsquo;t build an arbitrarily tall tower, so to put an <span style="color:rgb(255, 35, 21)"><strong>emitter</strong></span> well above the ground level we&rsquo;ll have to attach it to a <em>satellite</em> that we&rsquo;ll place high enough that it sees a reasonably big section of Earth. One could naively hope that we can just put a satellite in any place in space and it will just stay there, but unfortunately things aren&rsquo;t that simple.</p>
<h1 id="orbits">Orbits<a href="index.html#orbits" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>Let&rsquo;s see what would happen to an object if we could magically put it motionless in space somewhere around the Earth. In the demonstration below you can drag the <span style="color:#FFB200"><strong>yellow object</strong></span> around. Once you let it go it will get pulled by the Earth&rsquo;s gravity which I&rsquo;ve symbolized with <span style="color:#4A7AB8"><strong>little blue arrows</strong></span>. As the <span style="color:#FFB200"><strong>object</strong></span> starts to move a <span style="color:#B79545"><strong>yellow arrow</strong></span> reflects its current velocity:</p>
<div class="drawer_container full_width ratio_60" id="satellite_sim0"></div>
<p>Note that the strength at which the <span style="color:#FFB200"><strong>object</strong></span> is pulled towards the planet varies with distance. That force of gravity <span style="color:#fff"><strong>F</strong></span> pulling an object is proportional to the mass of that object <span style="color:#fff"><strong>m</strong></span> and mass of the Earth <span style="color:#fff"><strong>M</strong></span>, but it&rsquo;s <em>inversely</em> proportional to the square of the distance <span style="color:#fff"><strong>r</strong></span> between the centers of their masses:</p>
<div class="equation">
F = <span class="equation_frac">
    <span>G &times; m &times; M</span>
    <span class="equation_div_symbol">/</span>
    <span class="equation_div_bottom">r<sup>2</sup></span> 
</span>
</div>
<p>The constant <span style="color:#fff"><strong>G</strong></span> is known as the <a href="https://en.wikipedia.org/wiki/Gravitational_constant"><em>gravitational constant</em></a> and it&rsquo;s very small – it takes an object of an enormous mass like that of the Earth for the force of gravity to be perceptible at our human scales.</p>
<p>Regardless of where in space we put a <em>motionless</em> object, it will eventually fall down on Earth, but interesting things happen when the object&rsquo;s initial velocity is <em>not</em> zero. In the demonstration below you can once again drag the <span style="color:#FFB200"><strong>object</strong></span> around, but this time it will have some initial velocity that was perhaps given to it by a rocket. Once you let go, the <span style="color:#FFB200"><strong>object</strong></span> will initially move in that direction, but the Earth&rsquo;s <span style="color:#4A7AB8"><strong>gravity</strong></span> will still keep pulling on it:</p>
<div class="drawer_container full_width ratio_60" id="satellite_sim1"></div>
<p>Notice that the movement of the <span style="color:#FFB200"><strong>object</strong></span> is much more interesting now – the <span style="color:#4A7AB8"><strong>gravity</strong></span> keeps redirecting the <span style="color:#FFB200"><strong>object</strong></span> towards the center, but it manages to stay ahead of that pull which results in an elliptical trajectory. Notice that the speed of the <span style="color:#FFB200"><strong>object</strong></span>, as shown by the length of the <span style="color:#B79545"><strong>yellow arrow</strong></span>, varies over the course of its journey. When the object is far away from Earth the gravitational field is weak and it takes a while for <span style="color:#4A7AB8"><strong>gravity</strong></span> to change the <span style="color:#FFB200"><strong>object&rsquo;s</strong></span> direction of travel, but close to Earth the strong gravitation quickly accelerates it.</p>
<p>If the trajectory <a href="index.html#" class="link_button" onclick="satellite_sim1_f0();return false;">intersects Earth</a>, the object will still fall down on ground, but in <a href="index.html#" class="link_button" onclick="satellite_sim1_f1();return false;">other cases</a> it will instead <em>orbit</em> Earth on an elliptical path. You may have also <a href="index.html#" class="link_button" onclick="satellite_sim1_f2();return false;">managed</a> to make the trajectory <span style="color:#B31615"><strong>red</strong></span> – the object is on a <a href="https://en.wikipedia.org/wiki/Hyperbolic_trajectory"><em>hyperbolic trajectory</em></a> and it will just fly away and never come back.</p>
<p>Naturally, we want the radio signal emitters to stay in the vicinity of the Earth so for our purposes only elliptical orbits are useful. I&rsquo;ve <a href="../earth-and-sun/index.html#ellipse">discussed ellipses</a> on this blog before, but it&rsquo;s worth doing a quick recap.</p>
<p>Before we continue, I need to note that some demonstrations in the following sections are animated – you can play and pause them by <span class="click_word">clicking</span><span class="tap_word">tapping</span> on the button in their bottom left corner. By default all animations are <span id="global_animate_on">enabled, but if you find them distracting, or if you want to save power, you can <a href="index.html#" class="link_button" onclick="global_animate(false);return false;">globally pause</a> all the following demonstrations.</span><span id="global_animate_off" class="hidden">disabled, but if you&rsquo;d prefer to have things moving as you read you can <a href="index.html#"  class="link_button" onclick="global_animate(true);return false;">globally unpause</a> them and have animations running.</span></p>
<p>The easiest way to draw an ellipse is to take two <span style="color:#777"><strong>small pins</strong></span> and wrap a string around them. If we then put a <span style="color:#FDCC33"><strong>yellow pencil</strong></span> inside that loop and keep the string taut while moving the <span style="color:#FDCC33"><strong>pencil</strong></span> around we&rsquo;ll draw an ellipse. By moving the <span style="color:#777"><strong>pins</strong></span> closer or further apart we can change the generated shape:</p>
<div class="drawer_container ratio_120" id="ellipse"></div>
<div id="ellipse_sl0"></div>
<p>Notice that I&rsquo;m painting sections of the strings with different colors. As we go around the curve, <span style="color:#B8291B"><strong>red</strong></span> and <span style="color:#1887AD"><strong>blue</strong></span> parts trade lengths, but the <em>sum</em> of their lengths is always the same which is the defining property of an ellipse. The <span style="color:#777"><strong>small pins</strong></span> are the <em>focal points</em> of that ellipse.</p>
<p>The shape of an ellipse is determined by its <a href="https://en.wikipedia.org/wiki/Eccentricity_(mathematics)"><em>eccentricity</em></a>. In this string contraption eccentricity is the ratio of the length of the <span style="color:#468813"><strong>green</strong></span> section to the sum of lengths of <span style="color:#B8291B"><strong>red</strong></span> and <span style="color:#1887AD"><strong>blue</strong></span> sections. The size of an ellipse is defined by its <a href="https://en.wikipedia.org/wiki/Semi-major_and_semi-minor_axes"><em>semi-major axis</em></a> which is half of its widest point, or half of sum of lengths of <span style="color:#B8291B"><strong>red</strong></span> and <span style="color:#1887AD"><strong>blue</strong></span> parts. When <a href="index.html#" class="link_button" onclick="ellipse_f0();return false;">eccentricity is 0</a>, an ellipse becomes a circle and it&rsquo;s semi-major axis is just the circle&rsquo;s radius.</p>
<p>Length of the semi-major axis of a satellite&rsquo;s elliptical orbit is one of its most important parameters. We&rsquo;ve already seen how the area of the Earth seen by a satellite changes with the distance. More importantly, as discovered by Kepler and formalized in his <a href="https://en.wikipedia.org/wiki/Kepler%27s_laws_of_planetary_motion#Third_law">third law</a>, the length of the semi-major axis <span style="color:#fff"><strong>a</strong></span> is tied to the time <span style="color:#fff"><strong>T</strong></span> it takes a celestial body to complete a single orbit – the quantity known as <a href="https://en.wikipedia.org/wiki/Orbital_period"><em>orbital period</em></a>:</p>
<div class="equation">
a<sup>3</sup> = T<sup>2</sup> &times; <span class="equation_frac">
    <span>G &times; M</span>
    <span class="equation_div_symbol">/</span>
    <span class="equation_div_bottom">4 &times; &pi;<sup>2</sup></span> 
</span>
</div>
<p>As a result, the further away the satellite is, the longer it takes to trace a full ellipse which you can experience in the demonstration below. Notice that the ellipse is embedded in a plane known as <em>orbital plane</em>, I&rsquo;ve visualized it with a <span class="orbital_plane"><strong>yellow disc</strong></span>:</p>
<div class="drawer_container ratio_110" id="orbital_period"></div>
<div id="orbital_period_sl0"></div>
<p>For example, the International Space Station is <a href="index.html#" class="link_button" onclick="orbital_period_f0();return false;">very close</a> to Earth and it orbits the planet in just under 93 minutes – roughly 15.5 times per day. Notice that there is only <a href="index.html#" class="link_button" onclick="orbital_period_f1();return false;">one orbit</a> that takes 23 h 56 min 4 s – the length of a <a href="../earth-and-sun/index.html#sidereal_day_paragraph">sidereal day</a> during which the Earth performs a single revolution around its axis. Satellites with that orbital period are called <em>geosynchronous</em>. Let&rsquo;s look at them up close. The <span style="color:rgb(255, 35, 21)"><strong>red dot</strong></span> shows a point on Earth where a geosynchronous satellite is directly above the observer:</p>
<div class="drawer_container ratio_110" id="orbital_inclination"></div>
<div id="orbital_inclination_sl0"></div>
<div class="slider_inclination" id="orbital_inclination_sl1"></div>
<p>Notice that after a single revolution of the Earth the satellite returns to the same position. You may have noticed that the <span class="inclination"><strong>red slider</strong></span> controls the <em>inclination</em> of the orbit which is the angle between the <span class="orbital_plane"><strong>orbital plane</strong></span> and the <span class="equatorial_plane"><strong>plane</strong></span> passing through the Earth&rsquo;s equator known as <em>equatorial plane</em>. When that angle <a href="index.html#" class="link_button" onclick="orbital_inclination_f0();return false;">measures 0°</a> the red point doesn&rsquo;t move on the Earth at all, the satellite is always present at the same point in the sky, and that orbit is known as a <em>geostationary</em> orbit.</p>
<p>A geostationary orbit sounds like a good choice for placing a bunch of satellites of a positioning system, as each one would have a fixed and known position in the sky and a receiver could just measure distances to the ones it sees. However, that approach has a few problems.</p>
<p>In the demonstration below, you can control the number of geostationary satellites that are evenly distributed across the orbit. Each satellite is visible to a different section of the planet, but as the number of satellites grows, some areas of the Earth see more and more satellites. The number of visible satellites from that location on Earth is represented using colors of increasing <strong><span style="color:rgb(59, 14, 99)">i</span><span style="color:rgb(97, 30, 106)">n</span><span style="color:rgb(135, 46, 101)">t</span><span style="color:rgb(172, 64, 86)">e</span><span style="color:rgb(204, 90, 66)">n</span><span style="color:rgb(226, 124, 54)">s</span><span style="color:rgb(238, 168, 61)">i</span><span style="color:rgb(241, 214, 95)">t</span><span style="color:rgb(252, 254, 174)">y</span></strong>:</p>
<div class="drawer_container ratio_120" id="geostat_coverage"></div>
<div id="geostat_coverage_sl0"></div>
<p>With 10 satellites <a href="index.html#" class="link_button" onclick="geostat_coverage_f0();return false;">in place</a> all parts of the Earth close to equator have visibility of at least 4 satellites required to calculate the position and time offset. Unfortunately, even with a huge number of geostationary satellites the areas close to the South and North Pole would never see any satellites making the system not completely global.</p>
<p>Another problem with geostationary satellites is related to any configuration where all satellites lie on the same plane. Let&rsquo;s look at one of those configurations in which the satellites are closer to Earth making things easier to see. In the demonstration below you can drag the <span style="color:rgb(255, 35, 21)"><strong>red point</strong></span> around to change its position on the globe. The <span style="color:rgb(154, 22, 14)"><strong>darker red lines</strong></span> show calculated distances to each of the visible satellites:</p>
 <div class="drawer_container ratio_100" id="geostat_distance"></div>
<p>Notice that on the other hemisphere there is a <span style="color:#fff"><strong>white point</strong></span> that, due to symmetry, has the <em>exact</em> same distances to the satellites! If positioning satellites were arranged on the geostationary orbit we wouldn&rsquo;t be able to tell if we&rsquo;re on southern or northern latitudes using trilateration as the only cue because we can&rsquo;t determine which of the two possible options is the right one.</p>
<p>With those restrictions in mind, we can now discuss how the Global Positioning System solves these problems by using satellites that do <em>not</em> use geostationary orbits and as such do <em>not</em> have a fixed position in the sky for the observers on Earth.</p>
<h1 id="gps-orbits">GPS Orbits<a href="index.html#gps-orbits" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>Let&rsquo;s look at an orbit of a single GPS satellite around the Earth. The <span style="color:rgb(255, 35, 21)"><strong>red point</strong></span> shows a location on Earth where the satellite is directly above an observer:</p>
<div class="drawer_container ratio_100" id="gps_orbits0"></div>
<p>A single GPS orbit has an inclination of around 55 degrees and an orbital period of 11h 58m 2s which is a half of a sidereal day causing them to pass over the same place on Earth twice per day. This was particularly useful during GPS development when only a limited number of satellites was available, but their periodical visibility in the sky could&rsquo;ve been consistently relied on.</p>
<p>GPS consists of 6 different orbits placed around the Earth. Originally, each orbit contained 4 satellites for a total of 24 satellites. However, these days there are 30 active GPS satellites which improves accuracy and ensures redundancy. In the demonstration below you can select each of the 6 orbits or show all satellites from the entire <em>constellation</em>:</p>
<div class="drawer_container ratio_100" id="gps_orbits1"></div>
<div class="dark" id="gps_orbits1_seg0"></div>
<p>Notice that within an orbit the satellites aren&rsquo;t evenly distributed. As Earth rotates and satellites move around the number of satellites visible from a point on Earth changes. In the demonstration below you can drag the <span style="color:rgb(255, 35, 21)"><strong>red point</strong></span> on Earth to observe the satellites it sees:</p>
<div class="drawer_container ratio_100" id="gps_orbits2"></div>
<p>We can also visualize the number of visible satellites from <em>every</em> point on Earth. Let&rsquo;s look at that coverage of by marking different regions of Earth with colors of different <strong><span style="color:rgb(59, 14, 99)">i</span><span style="color:rgb(97, 30, 106)">n</span><span style="color:rgb(135, 46, 101)">t</span><span style="color:rgb(172, 64, 86)">e</span><span style="color:rgb(204, 90, 66)">n</span><span style="color:rgb(226, 124, 54)">s</span><span style="color:rgb(238, 168, 61)">i</span><span style="color:rgb(241, 214, 95)">t</span><span style="color:rgb(252, 254, 174)">y</span></strong> – it once again represents the number of visible satellites:</p>
<div class="drawer_container ratio_110" id="gps_orbits3"></div>
<p>While I&rsquo;m not accounting for local hills or buildings, you can observe that each part of the Earth is easily covered by at least 4 satellites allowing the receiver to calculate its position and clock bias. We&rsquo;ll soon see that the more satellites visible, the better accuracy of the predicted position is, but not all placements of satellites are equally favorable.</p>
<p>With all those satellites moving in the sky you may wonder how a receiver can know where the satellites are. The solution to this problem is simple yet absolutely brilliant – each satellite <em>tells</em> the receiver where it is as a part of its broadcasted signal.</p>
<h1 id="keplerian-elements">Keplerian Elements<a href="index.html#keplerian-elements" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>There are many ways to specify a position in space, but traditionally six <a href="https://en.wikipedia.org/wiki/Orbital_elements#Keplerian_elements">Keplerian elements</a> are commonly used. The first two elements, <span class="semi_major_axis"><strong>semi-major axis</strong></span> and <span class="eccentricity"><strong>eccentricity</strong></span>, specify the size and proportions of the orbital ellipse. For satellites, Earth is one of the focal points of the ellipse:</p>
<div class="drawer_container ratio_110" id="keplerian0"></div>
<div class="slider_semi_major_axis" id="keplerian0_sl0"></div>
<div class="slider_eccentricity" id="keplerian0_sl1"></div>
<p>GPS satellites have a <span class="semi_major_axis"><strong>semi-major axis</strong></span> of around <span class="imperial_word">16503 mi</span><span class="metric_word">26560 km</span> and <span class="eccentricity"><strong>eccentricity</strong></span> of around 0.02 or smaller.</p>
<p>The next two elements, <span class="inclination"><strong>inclination</strong></span> and <span class="longitude"><strong>longitude of the ascending node</strong></span>, specify the orientation of the orbital plane relative to Earth and distant stars:</p>
<div class="drawer_container ratio_110" id="keplerian1"></div>
<div class="slider_inclination" id="keplerian1_sl0"></div>
<div class="slider_longitude" id="keplerian1_sl1"></div>
<p>We&rsquo;ve already seen <span class="inclination"><strong>inclination</strong></span> in action – GPS satellites operate at an inclination of around 55°. <span class="longitude"><strong>Longitude of the ascending node</strong></span> deserves a bit more explanation. Notice that the ellipse of satellite&rsquo;s orbit intersects the <span class="equatorial_plane"><strong>equatorial plane</strong></span> at two different locations known as <em>orbital nodes</em> – I&rsquo;ve marked them with <span style="color:#B12420"><strong>red</strong></span> and <span style="color:#4EB300"><strong>green</strong></span> dots. The <span style="color:#4EB300"><strong>green</strong></span> one is the <em>ascending node</em>, because the satellite rises up or <em>ascends</em> at that location – it moves north.</p>
<p><span class="longitude"><strong>Longitude of the ascending node</strong></span> is the angle on the <span class="equatorial_plane"><strong>equatorial plane</strong></span> measured from a <a href="https://en.wikipedia.org/wiki/First_Point_of_Aries">certain reference direction</a> that is fixed against distant stars and doesn&rsquo;t follow the Earth&rsquo;s rotation. GPS constellation consists of 6 different orbits – their <span class="longitude"><strong>longitudes of the ascending nodes</strong></span> are evenly separated by 60°.</p>
<p>The last two elements, <span class="perigee"><strong>argument of perigee</strong></span> and <span class="true_anomaly"><strong>true anomaly</strong></span>, specify the position of the orbital ellipse and the satellite itself:</p>
<div class="drawer_container ratio_110" id="keplerian2"></div>
<div class="slider_perigee" id="keplerian2_sl0"></div>
<div class="slider_true_anomaly" id="keplerian2_sl1"></div>
<p><span class="perigee"><strong>Argument of perigee</strong></span> defines the orientation of the ellipse within the orbital plane measured from the ascending node to the <span style="color:#E5C13A"><strong>perigee</strong></span> that is the point on the ellipse closest to Earth – I marked it with a <span style="color:#E5C13A"><strong>yellow dot</strong></span>. The final parameter is <span class="true_anomaly"><strong>true anomaly</strong></span>, which is the angle between the <span style="color:#E5C13A"><strong>perigee</strong></span> and the satellite itself as measured <em>at a specific time</em>.</p>
<p>In an idealized scenario, that fixed set of six parameters would be enough to calculate the current and <em>future</em> positions of a satellite at any point in time, but unfortunately there are other effects at play. A satellite&rsquo;s orbit gets perturbed from pristine Keplerian pathways by other effects like the not perfectly spherical shape of the Earth, the gravity of Moon and Sun, and solar radiation. As part of the broadcasted message GPS satellites also include information of the <em>rate</em> of change of some of those parameters, which allows the receivers to calculate necessary corrections over time.</p>
<p>You may wonder how a GPS satellite knows all of these parameters. All GPS satellites are being tracked by monitoring stations on Earth. Those stations are part of the <em>Control Segment</em> of Global Positioning System which manages the satellites and the contents of messages they broadcast. Every two hours, updated orbital parameters and clock adjustments are uploaded to satellites, which ensures that the information sent from satellites to the receivers is as accurate as possible.</p>
<p>Knowing the position of a satellite on its orbit one can convert from Keplerian elements to <span class="rounded_bg solution"><strong>x</strong></span><span class="rounded_bg solution"><strong>y</strong></span><span class="rounded_bg solution"><strong>z</strong></span> coordinates in a Cartesian system tied to Earth. The details aren&rsquo;t important here, but the calculations account for a lot of different factors including the rotation of the Earth within the short time between the signal emission and the signal reception. As we&rsquo;ve seen before, the process of figuring out the location also requires accurate tracking of time, but that concept deserves a bit more elaboration.</p>
<h1 id="time">Time<a href="index.html#time" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>Trilateration with time of flight as a measure of distance requires that the clocks on all emitters are synchronized, and that is indeed the case for GPS. Each satellite carries a precise atomic clock and additionally the control stations can apply corrections to individual satellites to keep them in sync. That unified time is known as <em>GPS time</em> which for technical reasons is offset from the &ldquo;standard&rdquo; <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC time</a> by an integer number of seconds.</p>
<p>When it comes to the <em>flow</em> of time on those satellites, there are two important aspects related to Einstein&rsquo;s theories of relativity. <a href="https://en.wikipedia.org/wiki/Special_relativity">Special relativity</a> states that a fast moving object experiences time dilation – its clocks slow down relative to a stationary observer. The lower the altitude the faster the satellite&rsquo;s velocity and the bigger the time slowdown due to this effect. On the flip side, <a href="https://en.wikipedia.org/wiki/General_relativity">general relativity</a> states that clocks run faster in lower gravitational field, so the higher the altitude, the bigger the speedup is.</p>
<p>Those effects are not even and depending on altitude one or the other dominates. In the demonstration below you can witness how the altitude of a satellite affects the dilation of time relative to Earth. The progress of time is tracked by two separate bars. When the <span style="color:#CBA339"><strong>yellow bar</strong></span> gets filled it means that one second has elapsed on the <span style="color:#CBA339"><strong>satellite</strong></span>. When the <span style="color:#4A7AB8"><strong>blue bar</strong></span> gets filled it signifies that one second has elapsed on <span style="color:#4A7AB8"><strong>Earth</strong></span>. Notice that at high altitudes a second on the <span style="color:#CBA339"><strong>satellite</strong></span> finishes faster than a second on <span style="color:#4A7AB8"><strong>Earth</strong></span>, but at very low altitudes a second on the <span style="color:#CBA339"><strong>satellite</strong></span> takes longer to finish. Since the actual dilation is minuscule, the difference of bar lengths is greatly magnified to make things easier to see:</p>
<div class="drawer_container ratio_130" id="time_dilation"></div>
<div id="time_dilation_sl0"></div>
<p>Satellites at the <a href="index.html#" class="link_button" onclick="time_dilation_f0();return false;">GPS altitude</a> travel at the speed of about <span class="imperial_word">2.4 mi/s</span><span class="metric_word">3.87 km/s</span> relative to Earth, which slows the clock down, but they&rsquo;re also in weaker gravity which causes the clock to run faster. The latter effect is stronger which in total results in a gain of around 4.4647 × 10<sup>−10</sup> seconds per second, or around 38 microseconds a day.</p>
<p>Unfortunately, this is where many sources make a mistake with their interpretation of that result. It&rsquo;s often erroneously claimed that if GPS didn&rsquo;t correct for these relativistic effects by slowing down the clocks on satellites, the system would increase its error by around <span class="imperial_word">7.2 mi</span><span class="metric_word">11.6 km</span> per day as this is the distance that light travels in those 38 microseconds.</p>
<p>Those assertions are not true. If relativistic effects weren&rsquo;t accounted for and we let the clocks on satellites drift, the <em>pseudoranges</em> would indeed increase by that amount every day. However, as we&rsquo;ve seen, an incorrect clock offset doesn&rsquo;t prevent us from calculating the correct <em>position</em>. The calculated receiver clock bias would also be correct, but that bias would be relative to the drifting satellite clock making it much less useful.</p>
<p>Moreover, the clocks on satellites don&rsquo;t have to be explicitly slowed down to fix the cumulative relativistic speed-up of time. As part of their broadcasted message a satellite emits three coefficients that allow the receiver to correct for any offset or speed change of that satellite&rsquo;s clock.</p>
<p>One area where we <em>explicitly</em> have to account for relativistic effects is caused by slightly eccentric trajectories of the GPS satellites. As a satellite orbits the Earth its distance and speed relative to the planet change, which then causes periodic variations in the satellites’ clock speeds. Since the receiver knows the satellites’ positions it accounts for that relativistic variation when calculating timing corrections.</p>
<p>Unfortunately, this is not the only source of complications for evaluation of the time of flight.</p>
<h1 id="signal-propagation">Signal Propagation<a href="index.html#signal-propagation" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>While for most of their journey GPS signals travel uninterrupted through the vacuum of space, at some point they encounter the Earth&rsquo;s atmosphere which affects them with two different mechanisms. In the upper part of the atmosphere known as the <a href="https://en.wikipedia.org/wiki/Ionosphere"><em>ionosphere</em></a>, the solar radiation ionizes gasses, which increases the number of free electrons that slow down propagation of the coded message. The amount of free electrons and the slowdown depend on time of day and overall solar activity.</p>
<p>In the lowest part of the atmosphere, mostly in the <a href="https://en.wikipedia.org/wiki/Troposphere"><em>troposphere</em></a>, the larger density of gasses and water vapor increases the <a href="../cameras-and-lenses/index.html#lens_wave_glass">index of refraction</a>, which also slows down the radio signals. The water vapor amount can be highly variable, making the delay in signal&rsquo;s time of flight unpredictable.</p>
<p>The strength of these <em>ionospheric</em> and <em>tropospheric</em> delays also depends on the length of the path that radio signals have to travel in the <span style="color:#73C0D8"><strong>atmosphere</strong></span>, which in turn depends on the <span style="color:#777"><strong>elevation angle</strong></span> of the <span style="color:#9D8259"><strong>satellite signal</strong></span> relative to the receiver. We can see this in this <a href="https://en.wikipedia.org/wiki/File:Thin_Line_of_Earth%27s_Atmosphere_and_the_Setting_Sun.jpg">backlit view</a> of the Earth:</p>
<div class="drawer_container full_width ratio_60" id="atmosphere"></div>
<div id="atmosphere_sl0"></div>
<p>As that <span style="color:#777"><strong>angle</strong></span> increases, the <span style="color:#9D8259"><strong>signal from a satellite</strong></span> travels more sideways and its larger portion gets <span style="color:#C82A18"><strong>affected</strong></span> by the <span style="color:#73C0D8"><strong>atmosphere</strong></span>. To account for this, GPS receivers ignore ranges measured from satellites at very low elevation angles.</p>
<p>While atmospheric effects are primary source of GPS inaccuracies, other sources of disturbances also exist. For example, the clocks on all satellites can&rsquo;t be <em>perfectly</em> synchronized. The orbital elements and their rates are also measured with some degree of uncertainty, so both the positions and timestamps received from satellites are not exact. On Earth the signal can bounce off different surfaces and take a longer path to reach the receiver compared to direct reception.</p>
<p>Although many of these factors can be to some extent accounted for, the measured distances to satellites will have some degree of error – we no longer deal with a single distance but a certain allowed <em>range</em> of distances. What this means is that the spheres we&rsquo;ve been intersecting actually have some thickness and we&rsquo;ll never be able to get a perfect solution where a few spheres of ranges intersect at a single spot.</p>
<p>We can try to visualize this thickness with actual satellites but you&rsquo;ll probably agree that&rsquo;s it&rsquo;s quite hard to see what&rsquo;s going around on the draggable <span style="color:rgb(255, 35, 21)"><strong>red point</strong></span> even though I&rsquo;m trying to reduce the clutter by only drawing halves of the spheres:</p>
<div class="drawer_container ratio_100" id="gps_orbits4"></div>
<p>To make things easier to see let&rsquo;s briefly drop down to a two dimensional case and consider a simplified scenario with signals from just three satellites. In the demonstration below, you can control two parameters: the <span style="color:#777"><strong>uncertainty</strong></span> of the measured distance, which ends up corresponding to the thickness of the border of the circle of range, and the <span class="bias"><strong>relative position</strong></span> of these satellites.</p>
<div class="drawer_container full_width ratio_70" id="overlap"></div>
<div id="overlap_sl0"></div>
<div class="slider_bias" id="overlap_sl1"></div>
<p>The receiver&rsquo;s position is somewhere in the <span style="color:#E21503"><strong>intersection</strong></span> of these three regions – the smaller that region the better the accuracy of our position estimation. Naturally, large <span style="color:#777"><strong>range uncertainty</strong></span> <a href="index.html#" class="link_button" onclick="overlap_f0();return false;">increases</a> the ambiguity of position, but the relative position of the satellites also matters. If they <a href="index.html#" class="link_button" onclick="overlap_f1();return false;">aren&rsquo;t well spread</a>, the exactness of calculated location also suffers. In this example we&rsquo;ve also assumed that the <span style="color:#777"><strong>uncertainty</strong></span> of measurement is the same for all satellites, but it usually won&rsquo;t be the case.</p>
<p>To account for all these issues GPS receivers try to find such a set of four solutions, three position coordinates and the clock bias, that will in some sense be a best fit that minimizes the error – this is where using data from more than 4 satellites allows a receiver to improve the accuracy.</p>
<p>The calculated clock bias may seem like a trivial companion to the much desired location, but it&rsquo;s very useful in many applications that require time synchronization – we literally get easy, albeit indirect, access to atomic clocks.</p>
<p>Since we&rsquo;re talking about a receiver on Earth, it&rsquo;s only appropriate if we come back from the darkness of space to the bright surface of our planet.</p>

    </div>
</div>
<div class="dark_light_bg_grad_bottom"></div>
<p>So far I&rsquo;ve been fairly vague about the message that reaches a receiver, what that message contains, and how it&rsquo;s decoded, but those details are fascinating – I&rsquo;ll discuss them in the last two sections of this article.</p>
<h1 id="navigation-message">Navigation Message<a href="index.html#navigation-message" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>The information sent by a GPS satellite is collectively known as a <em>navigation message</em>. I&rsquo;ll go over most of its pieces one by one, but first let&rsquo;s look at its structure. The entire message consists of 25 <span class="frame"><strong>frames</strong></span>, each <span class="frame"><strong>frame</strong></span> consists of 5 <span class="subframe"><strong>subframes</strong></span>. Each <span class="subframe"><strong>subframe</strong></span>, represented by a single row, consists of 10 <span class="word"><strong>words</strong></span>, and each <span class="word"><strong>word</strong></span> consists of 30 bits:</p>
<div class="padding_wrapper">
<table id="message_table">
<tr>
<td class="subframe_header"></td>
<td class="word"></td>
<td class="word"></td>
<td class="word"></td>
<td class="word"></td>
<td class="word"></td>
<td class="word"></td>
<td class="word"></td>
<td class="word"></td>
<td class="word"></td>
<td class="word"></td>
</tr>
<tr>
<td rowspan="5" class="subframe"></td>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Clock corrections, health</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Ephemeris</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Ephemeris</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Almanac/other – page 1</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Almanac – page 1</td>
</tr>
<tr class="separator">
<td colspan="11"></td>
</tr>
<tr>
<td rowspan="5" class="subframe dim"></td>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Clock corrections, health</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Ephemeris</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Ephemeris</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Almanac/other – page 2</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Almanac – page 2</td>
</tr>
<tr class="separator">
<td colspan="11"></td>
</tr>
<tr class="ellipsis">
<td colspan="11">&middot;&middot;&middot;</td>
</tr>
<tr class="separator">
<td colspan="11"></td>
</tr>
<tr>
<td rowspan="5" class="subframe"></td>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Clock corrections, health</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Ephemeris</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Ephemeris</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Almanac/other – page 25</td>
</tr>
<tr>
<td class="right_border">TLM</td><td class="right_border">HOW</td><td colspan="8">Almanac – page 25</td>
</tr>
</table>
</div>
<p>The first two <span class="word"><strong>words</strong></span> of every <span class="subframe"><strong>subframe</strong></span> have the same structure. <strong>TLM</strong>, or telemetry word, contains a fixed preamble that&rsquo;s easy to recognize, and some bits intended to check the integrity of the message. <strong>HOW</strong>, or handover word, is vital for GPS functionality – it timestamps the <span class="subframe"><strong>subframe</strong></span>, which lets the receiver figure out when it was emitted.</p>
<p>The subsequent 8 <span class="word"><strong>words</strong></span> of each <span class="subframe"><strong>subframe</strong></span> carry different payload. The first <span class="subframe"><strong>subframe</strong></span> contains the satellite clock corrections and the week number of GPS time, which, together with the more fine-grained timestamp from handover word lets the receiver calculate the exact time the message was sent.</p>
<p>This <span class="subframe"><strong>subframe</strong></span> also contains a &ldquo;health&rdquo; bit, which describes if the navigation data is in a good state. When an orbit of a GPS satellite needs to be adjusted, the Control Segment will temporarily toggle that bit to let the receivers know that they shouldn&rsquo;t rely on the information from that satellite as it tweaks its position.</p>
<p>The next two <span class="subframe"><strong>subframes</strong></span> contain the already mentioned orbital parameters extended by velocity information which are collectively known as <em>ephemeris</em> parameters – they allow the receiver to calculate the satellite&rsquo;s position.</p>
<p>The first three <span class="subframe"><strong>subframes</strong></span> are always present in every <span class="frame"><strong>frame</strong></span> and they contain data related to this satellite, but the last two <span class="subframe"><strong>subframes</strong></span> contain the coarse ephemeris data for <em>all</em> satellites – that collection is known as <em>almanac</em>. This lets the receiver approximate when a new satellite would rise above the horizon. The other information carried in these <span class="subframe"><strong>subframes</strong></span> include health of other satellites and some parameters that allow the receiver to try to account for ionospheric delay.</p>
<p>As you can imagine, this entire payload is fairly large, so it is split across 25 pages – a single <span class="frame"><strong>frame</strong></span> contains only a single page placed in the last two <span class="subframe"><strong>subframes</strong></span>. The receiver has to gather all 25 <span class="frame"><strong>frames</strong></span> to fully decode that supplementary information.</p>
<p>The data rate at which GPS satellites send their signals is astonishingly small – they transfer only 50 bits every second. At that rate sending just the text contents of this article would take almost 2.5 hours. This means that a single <span class="subframe"><strong>subframe</strong></span> consisting of 10 <span class="word"><strong>words</strong></span>, each occupying 30 bits, takes 6 seconds to transfer and a single <span class="frame"><strong>frame</strong></span> is received over 30 seconds.</p>
<p>That 6 second granularity of timestamps in each <span class="subframe"><strong>subframe</strong></span> is very coarse, but, as we&rsquo;ll soon see, the way the bits of the navigation message are encoded and decoded carries with it a lot of additional precision.</p>
<h1 id="gps-signals">GPS Signals<a href="index.html#gps-signals" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>While at a high level the navigation message can be divided into <span class="frame"><strong>frames</strong></span>, <span class="subframe"><strong>subframes</strong></span>, and <span class="word"><strong>words</strong></span>, it ultimately consists of individual bits of <span class="data"><strong>data</strong></span>, each equal to either 0 or 1. A GPS satellite emits these bits over time which we can represent on a animated plot. In the demonstration below when the bit of the <span class="data"><strong>source data</strong></span> has a value of 1 the plot jumps above the horizontal axis, but for 0 it simply stays on it:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_20" id="signal0"></div>
</div>
<p>The data payload is transferred over radio waves in a <a href="https://en.wikipedia.org/wiki/L_band">specific range</a> of the radio spectrum that is not obscured by atmospheric effects and can reach the receivers on Earth regardless of the outdoor conditions. While modern GPS satellites emit signals at a few different frequencies, the primary civilian signal is broadcasted at 1575.42 MHz by all satellites. I will represent that <span class="carrier"><strong>base radio wave</strong></span> with the following sine wave:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_20" id="signal1"></div>
</div>
<p>On its own, a steady radio wave like that doesn&rsquo;t convey much information, but we will use it as a <em>carrier</em> wave that we&rsquo;ll modulate to make it carry the payload of data. There are many ways to do that modulation. We could, for example, multiply the <span class="carrier"><strong>carrier wave</strong></span> by the stream of <span class="data"><strong>data bits</strong></span> effectively turning the <span class="output"><strong>emitted signal</strong></span> on and off:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_60" id="signal2"></div>
</div>
<p>For transmission of its signals, GPS uses a <em>different</em> method known as <a href="https://en.wikipedia.org/wiki/Phase-shift_keying#Binary_phase-shift_keying_(BPSK)"><em>binary phase-shift keying</em></a>. Conceptually, the binary signal of ones and zeros gets adjusted to replace every 0 with −1, and then that <span class="data"><strong>signal</strong></span> gets multiplied by the <span class="carrier"><strong>carrier wave</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_80" id="signal3"></div>
</div>
<p>That multiplication by −1 ends up shifting the signal&rsquo;s <a href="https://en.wikipedia.org/wiki/Phase_(waves)">phase</a> which explains the name of the method. If we were dealing with just a single satellite this method of encoding would be sufficient as the receiver could just remove the carrier from the <span class="output"><strong>incoming signal</strong></span> and decode the <span class="violet"><strong>data bits</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_40" id="signal13"></div>
</div>
<p>In reality things are more complicated. There are many satellites broadcasting at the same time, so the data bits from all of them overlap. Additionally, the GPS signals reaching Earth are incredibly weak and they get swamped with noise, which would make a bare data payload indecipherable:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_40" id="signal12"></div>
</div>
<p>GPS solves this problem by employing another binary code. This <span class="code"><strong>code</strong></span> repeats over time and consists of a predetermined number of so-called <em>chips</em>. In this example there are 6 chips in the <span class="code"><strong>code</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_40" id="signal14"></div>
</div>
<p>The chipping code changes at a higher rate than the source bits. To encode the signal the satellite multiplies the <span class="data"><strong>data bits</strong></span> of the navigation message by that <span class="code"><strong>code</strong></span>. Let&rsquo;s see how this idea works in practice:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div signal_div ratio_60" id="signal4"></div>
</div>
<p>In this example, for every bit of the <span class="data"><strong>data signal</strong></span>, we&rsquo;re repeating two sets of the same <span class="code"><strong>code</strong></span>. Notice that the negative value of <span class="data"><strong>data signal</strong></span> ends up flipping the <span class="code"><strong>coding signal</strong></span> as well.</p>
<p>The <span class="data"><strong>input data</strong></span>, the <span class="code"><strong>code</strong></span>, and the <span class="carrier"><strong>carrier wave</strong></span> are all multiplied together to create the <span class="output"><strong>final signal</strong></span> that the satellite emits:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_100" id="signal5"></div>
</div>
<p>I need to note that for the sake of clarity I&rsquo;m using a visually compact example – each bit of the <span class="data"><strong>navigation message</strong></span> is represented by 2 lengths of the repeating <span class="code"><strong>code</strong></span>, each <span class="code"><strong>code</strong></span> consists of 6 chips, and each chip lasts 2 wavelengths.</p>
<p>In real GPS signals those numbers are much larger. There are 20 repetitions of the chipping code inside a single bit of the message and each chipping code consists of 1023 individual chips. Each chip then lasts for 1540 wave cycles. If we multiply all these numbers together we get 31,508,400 wave cycles per bit, which, at 50 bits per seconds, ends up as the exact 1575.42 MHz.</p>
<p>Moreover, we&rsquo;re actually dealing with an entire family of these codes – every satellite has a unique one. In the demonstration below you can see the first three of the so-called PRN codes that the GPS satellites emit:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_60" id="signal9"></div>
</div>
<p>Even though the codes look like a binary random noise, they&rsquo;re in fact <em>pseudorandom</em> which explains their name – PRN stands for pseudorandom noise. Each of those codes is well known and can be easily recreated.</p>
<p>The addition of the code may seem like a needless complication, but it&rsquo;s actually extremely useful. Those pseudorandom codes have two important properties. The first one defines how well a code correlates with its copy shifted in time. Let&rsquo;s see what this means in practice on a much shorter code of length 63. In the demonstration below you can slide a <span class="replica"><strong>replica of the code</strong></span> and see the signal it generates when multiplied by the repeated <span class="code"><strong>original code</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_80" id="signal6"></div>
</div>
<div class="long_slider slider_code" id="signal6_sl0"></div>
<p>The bottom section of the simulation shows the sum of the <span class="positive_signal"><strong>positive</strong></span> and <span class="negative_signal"><strong>negative</strong></span> areas of the product of the <span class="code"><strong>code</strong></span> and its <span class="replica"><strong>replica</strong></span> as well as the <span class="difference_signal"><strong>difference</strong></span> of these two areas. Notice that when the <a href="index.html#" class="link_button" onclick="signal6_f0();return false;">replica is not aligned</a> the <span class="difference_signal"><strong>difference</strong></span> of areas is relatively small, but when we <a href="index.html#" class="link_button" onclick="signal6_f1();return false;">manage to align</a> the replica with the signal the <span class="difference_signal"><strong>difference</strong></span> shoots up greatly. The correlation of the code signal with a copy of itself, or <em>auto-correlation</em>, is very high only when things are aligned correctly, and that jump in the magnitude of <span class="difference_signal"><strong>difference</strong></span> lets us detect that alignment.</p>
<p>The second important property is related to <em>cross-correlation</em>, or correlation with coding signal from a <em>different</em> satellite. Let&rsquo;s see what happens when we slide a <span class="replica"><strong>replica of code from satellite 1</strong></span> against a <span class="cyan"><strong>code from satellite 2</strong></span>:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_80" id="signal7"></div>
</div>
<div class="long_slider slider_code" id="signal7_sl0"></div>
<p>As you can see, when we slide the <span class="replica"><strong>replica</strong></span> around the <span class="difference_signal"><strong>difference of areas</strong></span> comes up a little bit, but it never reaches the highly discernible peak we&rsquo;ve seen for auto-correlation.</p>
<p>Those two properties unlock the magic that happens in the receiver. Let&rsquo;s take a look at a simplified version of those steps, at first using a <span class="output"><strong>clean incoming signal</strong></span> from just a single satellite. The receiver can remove the sinusoidal carrier wave and get the <span class="violet"><strong>signal</strong></span> that is a product of the navigation message and the chipping code:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_40" id="signal10"></div>
</div>
<p>The receiver can then create the <span class="replica"><strong>replica</strong></span> of the chipping code for a satellite it&rsquo;s trying to track, and then check if it can find a high correlation peak between the <span class="violet"><strong>input signal</strong></span> and that <span class="replica"><strong>replica</strong></span> as measured in the highlighted region. The receiver tweaks the offset until it finds high <span class="difference_signal"><strong>difference of areas</strong></span> which lets it know it found the correct offset value:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_120" id="signal11"></div>
<div class="long_slider slider_code" id="signal11_sl0"></div>
</div>
<p>As you observe the <span class="difference_signal"><strong>difference of areas</strong></span>, that is <span class="positive_signal"><strong>positive area</strong></span> minus <span class="negative_signal"><strong>negative area</strong></span>, after the <a href="index.html#" class="link_button" onclick="signal11_f0();return false;">correct offset</a> is found, you may notice that over time it flips between being positive and negative. Since the coding signal was originally multiplied by the sign-flipping data signal, the flipping we see on the plot is actually the decoded data – you can compare the plot of the <span class="difference_signal"><strong>difference of summed areas</strong></span> to the original <span class="data"><strong>data signal</strong></span> that I&rsquo;m showing at the bottom for completeness. After the correct offset has been found, the receiver can just look at the sign of that <span class="difference_signal"><strong>difference</strong></span> to decode the data bits.</p>
<p>The time offset of the <span class="replica"><strong>replica</strong></span> provides the receiver with additional timing information that lets it calculate the exact elapsed time of flight. Recall that each subframe of a GPS message is timestamped with a granularity of 6 seconds, which, on its own, would be atrociously low precision.</p>
<p>However, by keeping track of how many bits we&rsquo;ve seen, how many code repeats we&rsquo;ve seen, and the chip offset into the code we can significantly improve that precision. The receiver knows how much time each of these components occupies so it can add that duration on top of the timestamp encoded at the beginning of the subframe. We&rsquo;re effectively timestamping each chip or even its fractions. When the receiver is measuring the time of flight, this method lets it calculate that duration very precisely.</p>
<p>Finally, let&rsquo;s see how the cross-correlating properties allow the receiver to distinguish between different satellites. In the demonstration below, the <span class="violet"><strong>input signal</strong></span> is a combination of the signals emitted by a few visible satellites as well as some noise. You can select which of the replicas the receiver is generating and adjust the offset to tune in to a satellite&rsquo;s signal:</p>
<div class="padding_wrapper">
<div class="drawer_container signal_div ratio_120" id="signal8"></div>
<div class="long_slider slider_code" id="signal8_sl0"></div>
<div id="signal8_seg0"></div>
</div>
<p>After some tuning we can find the required time offsets to decode signals from <a href="index.html#" class="link_button" onclick="signal8_f0();return false;">satellite 1</a>, <a href="index.html#" class="link_button" onclick="signal8_f1();return false;">satellite 2</a>, and <a href="index.html#" class="link_button" onclick="signal8_f2();return false;">satellite 3</a>, but we can&rsquo;t find a good match for satellite 4. This is a likely scenario as only some of all the 30 satellites are visible at once to a receiver.</p>
<p>I need to emphasize that this was a simplified analysis of signal processing intended to illustrate how the chipping code allows the receiver to recover the original data bits. The behavior of an actual receiver is more complicated than what I&rsquo;ve described. One of those additional complexities worth mentioning is the velocity of a satellite relative to the observer on Earth. Due to <a href="https://en.wikipedia.org/wiki/Doppler_effect">Doppler effect</a> this changes the frequency of the signal as seen by the receiver. To correctly acquire the signal the device has to tune in on both the time offset <em>and</em> the appropriate frequency.</p>
<p>Finally, it&rsquo;s worth reiterating that the receiver doesn&rsquo;t need to send anything to the satellites, it just listens to the signals that the satellites restlessly emit without knowing if anyone receives them.</p>
<h1 id="further-watching-and-reading">Further Watching and Reading<a href="index.html#further-watching-and-reading" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p><a href="https://scpnt.stanford.edu/about/gps-mooc-massive-open-online-course">GPS MOOC</a> was an online course hosted by Stanford in 2014. Thankfully, the video recordings of the lectures are <a href="https://www.youtube.com/watch?v=o1Fyn_h6LKU&amp;list=PLGvhNIiu1ubyEOJga50LJMzVXtbUq6CPo">available on YouTube</a> and I highly recommend them for a deeper dive into GPS workings. Both presenters are experts in their domains and do an excellent job explaining the topics.</p>
<p>The textbook <a href="https://www.gpstextbook.com">Global Positioning System</a> by Pratap Misra and Per Enge provides an even more detailed exposition of the discussed topics. It&rsquo;s a thorough, but very readable publication on GPS and satellite navigation – it was my primary source for this article. I particularly liked that the book does a high level overview of all the elements of the system at first and then explores them individually in depth in later chapters.</p>
<p>For a personal description of the history of GPS I recommend <a href="https://ethw.org/Oral-History:Brad_Parkinson#Parkinson.27s_educational_background_and_the_origins_of_GPS.5D">the interview</a> with <a href="https://en.wikipedia.org/wiki/Bradford_Parkinson">Brad Parkinson</a>, who was the lead architect of the system. While the interview was conducted in 1999, still relatively early days of consumer GPS, Brad correctly predicted an upcoming explosion in widespread personal use.</p>
<h1 id="final-words">Final Words<a href="index.html#final-words" class="hanchor" ariaLabel="Anchor"><img src="../images/anchor.png" width="16px" height="8px"/></a> </h1>
<p>It&rsquo;s fascinating how much complexity and ingenuity is hidden behind the simple act of observing one&rsquo;s location in a mapping app on a smartphone. What I find particularly remarkable is how many different technological advancements were needed for GPS to work.</p>
<p>Just the satellites themselves required the development of rockets, mastery of orbital controls, and manufacturing prowess to build devices capable of withstanding the extremes of space.</p>
<p>Precise time tracking was made possible by the invention of an atomic clock, while advancements in radio transmission and clever coding algorithms allowed the very weak signal sent by satellites to be correctly deciphered on Earth by receivers, which were in turn dependent on microchips and the digital revolution.</p>
<p>It&rsquo;s hard not get inspired by the relentless drive of people who kept pushing science and technology forward. All of their work made GPS an indispensable tool in our everyday life.</p>

</div>
      </div>
    </div>
    <div id="footer">
        
<div class="article_footer">
If you enjoy these articles, consider supporting on <a href="https://www.patreon.com/ciechanowski">Patreon</a>.
</div>
Copyright &copy; 2024 Bartosz Ciechanowski
    </div>
  </div>
</body>

</html>